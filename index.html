<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三五七 ecx作弊工具</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .game-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .game-title {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .game-info {
            background-color: #e9f7fe;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .game-info h3 {
            margin-top: 0;
            color: #2c6ca0;
        }
        .game-board {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .pile {
            text-align: center;
            width: 100px;
        }
        .pile-items {
            height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        .item {
            width: 60px;
            height: 30px;
            background-color: #ff4444;
            margin: 2px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .item.selected {
            background-color: #44ff44;
        }
        .pile-label {
            font-weight: bold;
            font-size: 18px;
            color: #333;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        button#reset-btn {
            background-color: #2196F3;
        }
        .game-status {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
        .strategy-info {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .strategy-info h3 {
            margin-top: 0;
            color: #2e7d32;
        }
        .highlight {
            background-color: #fffde7;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">ecx作弊工具 357</h1>
        
        <div class="game-info">
            <h3>游戏规则</h3>
            <p>1. 游戏开始时有三堆物品，数量分别为 <strong>3个、5个和7个</strong>。</p>
            <p>2. 两名玩家轮流从任意一堆中拿走 <strong>任意数量</strong>（至少一个）的物品。</p>
            <p>3. <strong>拿走最后一个物品的玩家判负</strong>。</p>
        </div>
        
        <div class="game-board">
            <div class="pile">
                <div class="pile-items" id="pile1"></div>
                <div class="pile-label">第一堆: <span id="count1">3</span></div>
            </div>
            <div class="pile">
                <div class="pile-items" id="pile2"></div>
                <div class="pile-label">第二堆: <span id="count2">5</span></div>
            </div>
            <div class="pile">
                <div class="pile-items" id="pile3"></div>
                <div class="pile-label">第三堆: <span id="count3">7</span></div>
            </div>
        </div>
        
        <div class="controls">
            <button id="start-btn">开始游戏</button>
            <button id="next-btn" disabled>下一步</button>
            <button id="reset-btn">重置游戏</button>
        </div>
        
        <div class="game-status" id="status">游戏状态: 等待开始</div>
        

    </div>

    <script>
        // 游戏状态
        const gameState = {
            piles: [3, 5, 7],
            currentPlayer: 'computer',
            gameStarted: false,
            gameOver: false,
            selectedPile: null,
            itemsToTake: 0
        };

        const pileElements = [
            document.getElementById('pile1'),
            document.getElementById('pile2'),
            document.getElementById('pile3')
        ];
        const countElements = [
            document.getElementById('count1'),
            document.getElementById('count2'),
            document.getElementById('count3')
        ];
        const startBtn = document.getElementById('start-btn');
        const nextBtn = document.getElementById('next-btn');
        const resetBtn = document.getElementById('reset-btn');
        const status = document.getElementById('status');

        // 初始化
        function initGame() {
            gameState.piles = [3, 5, 7];
            gameState.currentPlayer = 'computer';
            gameState.gameStarted = false;
            gameState.gameOver = false;
            gameState.selectedPile = null;
            gameState.itemsToTake = 0;
            updatePiles();
            status.textContent = '游戏状态: 等待开始';
            startBtn.disabled = false;
            nextBtn.disabled = true;
        }

        // 重新绘制所有堆，并绑定点击
        function updatePiles() {
            for (let p = 0; p < 3; p++) {
                const pe = pileElements[p];
                pe.innerHTML = '';
                const total = gameState.piles[p];
                for (let i = 0; i < total; i++) {
                    const item = document.createElement('div');
                    item.className = 'item';
                    if (gameState.selectedPile === p && i < gameState.itemsToTake) {
                        item.classList.add('selected');
                    }
                    item.dataset.pile = p;
                    item.dataset.index = i;
                    item.addEventListener('click', onItemClick);
                    pe.appendChild(item);
                }
                countElements[p].textContent = total;
            }
        }

        // 点击物品
        function onItemClick(e) {
            if (gameState.currentPlayer !== 'human' || gameState.gameOver) return;
            const pile = parseInt(e.target.dataset.pile);
            const idx = parseInt(e.target.dataset.index);
            if (gameState.piles[pile] === 0) return;

            gameState.selectedPile = pile;
            gameState.itemsToTake = idx + 1;
            updatePiles();
            status.textContent = `游戏状态: 你选择从第${pile+1}堆拿${gameState.itemsToTake}个`;
        }

        // 异或值
        function xorAll() {
            return gameState.piles[0] ^ gameState.piles[1] ^ gameState.piles[2];
        }

        // 只剩最后一个
        function isOnlyOneLeft() {
            return gameState.piles.reduce((a,b)=>a+b,0) === 1;
        }

        // 电脑走棋（稳定必胜）
        function computerMove() {
            if (isOnlyOneLeft()) {
                // 被迫拿最后一个 → 电脑输
                for (let i=0; i<3; i++) {
                    if (gameState.piles[i]>0) {
                        gameState.piles[i]--;
                        status.textContent = `游戏状态: 电脑拿走最后1个，你赢了！`;
                        gameState.gameOver = true;
                        nextBtn.disabled = true;
                        updatePiles();
                        return;
                    }
                }
            }

            const x = xorAll();
            let moved = false;
            if (x !== 0) {
                for (let i=0; i<3; i++) {
                    const want = gameState.piles[i] ^ x;
                    if (want < gameState.piles[i]) {
                        const take = gameState.piles[i] - want;
                        gameState.piles[i] = want;
                        status.textContent = `游戏状态: 电脑从第${i+1}堆拿走${take}个`;
                        moved = true;
                        break;
                    }
                }
            }
            if (!moved) {
                // 随便拿一个
                for (let i=0; i<3; i++) {
                    if (gameState.piles[i]>0) {
                        gameState.piles[i]--;
                        status.textContent = `游戏状态: 电脑从第${i+1}堆拿走1个`;
                        moved = true;
                        break;
                    }
                }
            }
            updatePiles();

            if (isOnlyOneLeft()) {
                status.textContent = '游戏状态: 只剩最后1个，你输了！';
                gameState.gameOver = true;
                nextBtn.disabled = true;
            }
        }

        // 玩家走棋
        function playerMove() {
            if (gameState.selectedPile === null || gameState.itemsToTake < 1) {
                status.textContent = '游戏状态: 请先选择要拿几个';
                return false;
            }
            const p = gameState.selectedPile;
            const n = gameState.itemsToTake;
            if (n > gameState.piles[p]) {
                status.textContent = '游戏状态: 不能拿超过当前堆数量';
                return false;
            }
            gameState.piles[p] -= n;
            status.textContent = `游戏状态: 你从第${p+1}堆拿走${n}个`;
            gameState.selectedPile = null;
            gameState.itemsToTake = 0;
            updatePiles();

            if (isOnlyOneLeft()) {
                status.textContent = '游戏状态: 你被迫拿最后1个，你输了！';
                gameState.gameOver = true;
                nextBtn.disabled = true;
                return false;
            }
            return true;
        }

        // 下一步
        function nextStep() {
            if (gameState.gameOver) return;
            if (gameState.currentPlayer === 'computer') {
                if (!gameState.gameStarted) {
                    // 第一步固定 3 5 4
                    gameState.piles[2] = 4;
                    gameState.gameStarted = true;
                    status.textContent = '游戏状态: 电脑将第3堆变为4，形成 3、5、4 必胜局面';
                    updatePiles();
                } else {
                    computerMove();
                }
                if (!gameState.gameOver) {
                    gameState.currentPlayer = 'human';
                    nextBtn.disabled = false;
                }
            } else {
                if (playerMove()) {
                    if (!gameState.gameOver) {
                        gameState.currentPlayer = 'computer';
                        nextBtn.disabled = false;
                    }
                }
            }
        }

        // 事件
        startBtn.addEventListener('click', () => {
            startBtn.disabled = true;
            nextBtn.disabled = false;
            gameState.gameStarted = true;
            gameState.currentPlayer = 'computer';
            status.textContent = '游戏状态: 电脑先手';
            nextStep();
        });

        nextBtn.addEventListener('click', nextStep);
        resetBtn.addEventListener('click', initGame);

        initGame();
    </script>
</body>
</html>
